<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hyphon Skip</title>
<style>
  body { font-family:'Poppins',sans-serif; background:#fafafa; margin:0; padding:0; }
  h1 { text-align:center; margin:20px; font-size:2em; }
  h1 span { color:red; }
  .hidden { display:none; }
  #navbar { position:fixed; top:0; left:0; right:0; background:#222; color:white; display:flex; justify-content:space-around; padding:10px; }
  #navbar button { background:none; border:none; color:white; font-size:1em; cursor:pointer; }
  #content { margin-top:60px; padding:20px; text-align:center; }
  button { padding:15px; font-size:1.2em; margin:10px; border:none; border-radius:10px; cursor:pointer; }
  #loginBtn { background:#4CAF50; color:white; }
  #boostBtn { background:#ff69b4; color:white; }
  #passBtn { flex:1; margin:5px; padding:40px; background:#e74c3c; color:white; font-size:1.5em; }
  #likeBtn { flex:1; margin:5px; padding:40px; background:#2ecc71; color:white; font-size:1.5em; }
  #swipeControls { display:flex; justify-content:space-between; margin-top:20px; }
  .card,.swipeCard { border:1px solid #ccc; border-radius:15px; padding:15px; margin:15px auto; max-width:400px; background:white; box-shadow:0 4px 8px rgba(0,0,0,0.1); }
  .quest { border:1px solid #ccc; border-radius:10px; padding:10px; margin:10px auto; max-width:400px; background:#fff; box-shadow:0 2px 4px rgba(0,0,0,0.1); text-align:left; }
  .quest.completed { background:#d4edda; }
</style>
</head>
<body>

<h1>Hyphon <span>Skip</span></h1>

<div id="navbar" class="hidden">
  <button onclick="showMenu()">üè† Home</button>
  <button onclick="openCreate()">‚ûï Create</button>
  <button onclick="startSwipe()">üé¥ Swipe</button>
  <button onclick="openQuests()">‚≠ê Quests</button>
</div>

<div id="content">

  <!-- LOGIN -->
  <div id="loginScreen">
    <input id="usernameInput" placeholder="Enter username">
    <button id="loginBtn">Login</button>
  </div>

  <!-- MENU -->
  <div id="mainMenu" class="hidden">
    <p id="coinsDisplay">Coins: 0</p>
    <div id="myCards"></div>
  </div>

  <!-- CREATE -->
  <div id="createCardScreen" class="hidden">
    <textarea id="cardText" placeholder="Write your card..." style="width:90%;height:80px;"></textarea><br>
    <input type="file" id="mediaInput"><br>
    <button onclick="addCard(false)">Add Card</button>
    <button onclick="addCard(true)" id="boostBtn">Add & Boost (1 coin)</button>
  </div>

  <!-- SWIPE -->
  <div id="swipeScreen" class="hidden">
    <div id="swipeContainer"></div>
    <div id="swipeControls">
      <button id="passBtn" onclick="swipe(false)">Pass</button>
      <button id="likeBtn" onclick="swipe(true)">Like!</button>
    </div>
  </div>

  <!-- QUESTS -->
  <div id="questScreen" class="hidden">
    <h2>Quests</h2>
    <div id="quests"></div>
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBnxa5QbhfrD_8LTrZbrmjI5wVRKHSXGLg",
    authDomain: "gartictwo.firebaseapp.com",
    databaseURL: "https://gartictwo-default-rtdb.firebaseio.com",
    projectId: "gartictwo",
    storageBucket: "gartictwo.firebasestorage.app",
    messagingSenderId: "602694382683",
    appId: "1:602694382683:web:1dc11cb6b715944ba0fb7e"
  };
  firebase.initializeApp(firebaseConfig);
  const db=firebase.database();

  let username=null, coins=0, swipeQueue=[], currentSwipeCard=null;

  const questsConfig = {
    cards: [
      {id:"c10", goal:10, reward:1},
      {id:"c25", goal:25, reward:2},
      {id:"c50", goal:50, reward:5},
      {id:"c100", goal:100, reward:10},
      {id:"c250", goal:250, reward:25},
    ],
    likes: [
      {id:"l5", goal:5, reward:1},
      {id:"l10", goal:10, reward:2},
      {id:"l30", goal:30, reward:5},
      {id:"l50", goal:50, reward:10},
      {id:"l100", goal:100, reward:20},
      {id:"l500", goal:500, reward:100},
    ],
    views: [
      {id:"v10", goal:10, reward:1},
      {id:"v40", goal:40, reward:2},
      {id:"v50", goal:50, reward:5},
      {id:"v200", goal:200, reward:10},
      {id:"v500", goal:500, reward:25},
    ]
  };

  document.getElementById("loginBtn").onclick=()=>{
    let u=document.getElementById("usernameInput").value.trim();
    if(!u) return alert("Enter username!");
    username=u;
    db.ref("users/"+username).once("value").then(snap=>{
      if(!snap.exists()){ db.ref("users/"+username).set({coins:0,quests:{}}); }
    });
    loadUser();
    showMenu();
    document.getElementById("loginScreen").classList.add("hidden");
    document.getElementById("navbar").classList.remove("hidden");
  };

  function loadUser(){
    db.ref("users/"+username).on("value",snap=>{
      let data=snap.val(); if(!data) return;
      coins=data.coins||0;
      renderCards(data.cards||{});
      document.getElementById("coinsDisplay").innerText="Coins: "+coins;
    });
  }

  function hideAll(){ document.querySelectorAll("#mainMenu,#createCardScreen,#swipeScreen,#questScreen").forEach(el=>el.classList.add("hidden")); }
  function showMenu(){ hideAll(); document.getElementById("mainMenu").classList.remove("hidden"); }
  function openCreate(){ hideAll(); document.getElementById("createCardScreen").classList.remove("hidden"); }
  function openQuests(){ hideAll(); document.getElementById("questScreen").classList.remove("hidden"); loadQuests(); }

  function renderCards(cards){
    let div=document.getElementById("myCards");
    div.innerHTML="<h3>My Cards</h3>";
    for(let id in cards){
      let c=cards[id];
      div.innerHTML+=`
        <div class="card">
          <p>${c.text} ${c.boosted?"‚ú®":""}</p>
          <p>Likes: ${c.likes||0}, Views: ${c.views||0}</p>
        </div>`;
    }
  }

  function addCard(boost){
    let text=document.getElementById("cardText").value.trim();
    if(!text) return alert("Write something!");
    if(boost && coins<1){ alert("Not enough coins!"); return; }
    let file=document.getElementById("mediaInput").files[0];
    let reader=new FileReader();
    reader.onload=function(e){
      let media=file?{type:file.type,src:e.target.result}:null;
      let card={text,media,likes:0,views:0,skipped:0,boosted:boost};
      db.ref("users/"+username+"/cards").push(card);
      if(boost){ coins--; db.ref("users/"+username+"/coins").set(coins); }
      document.getElementById("cardText").value="";
      document.getElementById("mediaInput").value="";
      showMenu();
    };
    if(file) reader.readAsDataURL(file); else reader.onload();
  }

  function startSwipe(){
    hideAll(); document.getElementById("swipeScreen").classList.remove("hidden");
    swipeQueue=[];
    db.ref("users").once("value").then(snap=>{
      let all=snap.val()||{};
      for(let u in all){
        if(u===username) continue;
        let cards=all[u].cards||{};
        for(let id in cards){
          let c=cards[id]; if(!c) continue;
          let seen=(c.seenBy||[]);
          if(!seen.includes(username)){
            let copy={...c,owner:u,cardId:id};
            if(c.boosted) swipeQueue.unshift(copy);
            else swipeQueue.push(copy);
          }
        }
      }
      showNextCard();
    });
  }

  function showNextCard(){
    let div=document.getElementById("swipeContainer");
    div.innerHTML="";
    if(swipeQueue.length===0){ div.innerHTML="<p>No more cards!</p>"; currentSwipeCard=null; return; }
    currentSwipeCard=swipeQueue.shift();
    div.innerHTML=`<div class="swipeCard"><p>${currentSwipeCard.text} ${currentSwipeCard.boosted?"‚ú®":""}</p></div>`;
    db.ref("users/"+currentSwipeCard.owner+"/cards/"+currentSwipeCard.cardId+"/views").transaction(v=>(v||0)+1);
  }

  function swipe(like){
    if(!currentSwipeCard) return;
    let cardRef=db.ref("users/"+currentSwipeCard.owner+"/cards/"+currentSwipeCard.cardId);
    if(like) cardRef.child("likes").transaction(v=>(v||0)+1);
    else cardRef.child("skipped").transaction(v=>(v||0)+1);
    cardRef.child("seenBy").transaction(arr=>{ arr=arr||[]; if(!arr.includes(username)) arr.push(username); return arr; });
    showNextCard();
  }

  function loadQuests(){
    db.ref("users/"+username).once("value").then(snap=>{
      let data=snap.val()||{};
      let cards=data.cards||{};
      let totalCards=Object.keys(cards).length;
      let totalLikes=0,totalViews=0;
      for(let id in cards){ totalLikes+=(cards[id].likes||0); totalViews+=(cards[id].views||0); }
      let userQuests=data.quests||{};
      let div=document.getElementById("quests");
      div.innerHTML="";
      function renderPath(path,label,progress){
        div.innerHTML+=`<h3>${label}</h3>`;
        for(let q of questsConfig[path]){
          let done=userQuests[q.id];
          let eligible=progress>=q.goal;
          let cls=done?"quest completed":"quest";
          div.innerHTML+=`<div class="${cls}">
            <b>${label} ${q.goal}</b> ‚Üí Reward: ${q.reward} coins 
            ${done?"‚úÖ":" "+(eligible?`<button onclick="claimQuest('${q.id}',${q.reward})">Claim</button>`:"")}
          </div>`;
        }
      }
      renderPath("cards","Cards Created",totalCards);
      renderPath("likes","Likes Gained",totalLikes);
      renderPath("views","Views Gained",totalViews);
    });
  }

  function claimQuest(id,reward){
    db.ref("users/"+username+"/quests/"+id).set(true);
    coins+=reward;
    db.ref("users/"+username+"/coins").set(coins);
    loadQuests();
  }
</script>
</body>
</html>
