<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hyphon Skip</title>
<style>
  /* ---------- GENERAL ---------- */
  @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');
  body { margin:0; font-family:'Quicksand', sans-serif; background:white; }
  h1,h2,h3,h4,h5,h6 { margin:0; }
  button { cursor:pointer; border:none; border-radius:10px; padding:10px 20px; font-weight:700; transition: transform 0.2s; }
  button:hover { transform: scale(1.05); }
  .hidden { display:none; }

  /* ---------- LOGO ---------- */
  #logo { font-size:2.5em; text-align:center; margin:20px; }
  #logo .white { color:white; background:black; padding:0 10px; border-radius:5px; }
  #logo .red { color:red; }

  /* ---------- LOGIN ---------- */
  #loginScreen { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; }
  #loginScreen input { padding:10px; margin:5px 0; font-size:1em; width:200px; border-radius:8px; border:1px solid #ccc; }
  #loginScreen button { background: #ff4d4d; color:white; }

  /* ---------- MAIN MENU ---------- */
  #mainMenu { padding:20px; text-align:center; }
  .menu-btn { display:block; margin:20px auto; background:linear-gradient(45deg, #ff6b6b, #f06595); color:white; font-size:1.2em; width:200px; }
  #cardList { max-height:300px; overflow-y:auto; margin-top:20px; }
  .card { border-radius:15px; padding:15px; margin:10px 0; background:#f0f0f0; box-shadow:0 4px 6px rgba(0,0,0,0.1); position:relative; }
  .card img, .card video, .card audio { max-width:100%; border-radius:10px; margin-top:10px; }

  /* ---------- SWIPE MODE ---------- */
  #swipeScreen { position:relative; width:100%; max-width:400px; margin:20px auto; }
  .swipeCard { position:absolute; width:100%; border-radius:15px; padding:20px; background:#fff; box-shadow:0 6px 15px rgba(0,0,0,0.2); transition:0.3s ease; user-select:none; }
  .stats { margin-top:10px; font-size:0.85em; color:#555; }

  /* ---------- TOP NAV ---------- */
  nav { display:flex; justify-content:center; margin-bottom:20px; }
  nav button { margin:0 10px; background:#74c0fc; color:white; }

  /* ---------- QUESTS ---------- */
  #questsScreen { max-width:500px; margin:0 auto; }
  .questPath { margin:15px 0; padding:10px; background:#ffe066; border-radius:10px; }
  .quest { margin:5px 0; font-weight:600; }

  /* ---------- COINS & BOOST ---------- */
  #coinsDisplay { font-weight:700; margin-top:10px; }
</style>
</head>
<body>

<!-- LOGO -->
<div id="logo"><span class="white">Hyphon</span> <span class="red">Skip</span></div>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <h2>Login</h2>
  <input type="text" id="usernameInput" placeholder="Username">
  <button onclick="login()">Login</button>
</div>

<!-- MAIN MENU -->
<div id="mainMenu" class="hidden">
  <nav>
    <button onclick="showMenu()">Home</button>
    <button onclick="showQuests()">Quests</button>
    <button onclick="startSwipe()">Scroll Cards</button>
  </nav>
  <button class="menu-btn" onclick="showCreateCard()">Create Card</button>
  <div id="coinsDisplay">Coins: 0</div>
  <div id="cardList"></div>
</div>

<!-- CREATE CARD -->
<div id="createCardScreen" class="hidden" style="text-align:center; padding:20px;">
  <h2>Create a Card</h2>
  <textarea id="cardText" placeholder="Write something..." rows="3" style="width:80%; padding:10px; border-radius:10px; border:1px solid #ccc;"></textarea><br>
  <input type="file" id="mediaInput" accept="image/*,video/*,audio/*"><br><br>
  <button onclick="addCard()">Add Card</button>
  <button onclick="showMenu()">Back</button>
</div>

<!-- SWIPE CARDS -->
<div id="swipeScreen" class="hidden"></div>

<!-- QUESTS -->
<div id="questsScreen" class="hidden">
  <h2>Quests</h2>
  <div id="questsContainer"></div>
</div>

<script>
  let username = '';
  let users = JSON.parse(localStorage.getItem('users')||'{}');
  let currentCards = [];
  let coins = 0;

  function login() {
    username = document.getElementById('usernameInput').value.trim();
    if(!username) return alert('Enter username');
    if(!users[username]) users[username]={cards:[], coins:0};
    currentCards = users[username].cards;
    coins = users[username].coins || 0;
    showMenu();
  }

  function saveUser() {
    users[username].cards = currentCards;
    users[username].coins = coins;
    localStorage.setItem('users', JSON.stringify(users));
  }

  function showMenu() {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('createCardScreen').classList.add('hidden');
    document.getElementById('swipeScreen').classList.add('hidden');
    document.getElementById('questsScreen').classList.add('hidden');
    document.getElementById('mainMenu').classList.remove('hidden');
    renderCards();
    document.getElementById('coinsDisplay').innerText = 'Coins: '+coins;
  }

  function showCreateCard() {
    document.getElementById('mainMenu').classList.add('hidden');
    document.getElementById('createCardScreen').classList.remove('hidden');
  }

  function addCard() {
    let text = document.getElementById('cardText').value.trim();
    if(!text) return alert('Write something!');
    let file = document.getElementById('mediaInput').files[0];
    let reader = new FileReader();
    reader.onload = function(e){
      let media = file ? {type:file.type, src:e.target.result} : null;
      currentCards.push({text, media, likes:0, views:0, skipped:0});
      saveUser();
      document.getElementById('cardText').value='';
      document.getElementById('mediaInput').value='';
      updateQuests();
      showMenu();
    }
    if(file) reader.readAsDataURL(file);
    else reader.onload();
  }

  function renderCards() {
    let list = document.getElementById('cardList');
    list.innerHTML = '';
    currentCards.forEach((c,i)=>{
      let div = document.createElement('div');
      div.className='card';
      div.innerHTML = `<strong>Card ${i+1}:</strong> ${c.text}<div class="stats">Likes: ${c.likes} | Views: ${c.views} | Ratio: ${c.likes/(c.skipped+1)}</div>`;
      if(c.media){
        if(c.media.type.startsWith('image')) div.innerHTML+=`<img src="${c.media.src}">`;
        else if(c.media.type.startsWith('video')) div.innerHTML+=`<video controls src="${c.media.src}"></video>`;
        else if(c.media.type.startsWith('audio')) div.innerHTML+=`<audio controls src="${c.media.src}"></audio>`;
      }
      list.appendChild(div);
    });
  }

  /* ---------- SWIPE MODE ---------- */
  let swipeQueue=[];
  function startSwipe() {
    document.getElementById('mainMenu').classList.add('hidden');
    document.getElementById('swipeScreen').classList.remove('hidden');
    swipeQueue = [];
    for(let u in users){
      if(u===username) continue;
      users[u].cards.forEach(c=>{
        if(!c.seenBy) c.seenBy=[];
        if(!c.seenBy.includes(username)) swipeQueue.push({...c, owner:u});
      });
    }
    if(swipeQueue.length===0) document.getElementById('swipeScreen').innerHTML='No cards to swipe!';
    else showNextCard();
  }

  function showNextCard() {
    let container = document.getElementById('swipeScreen');
    container.innerHTML='';
    if(swipeQueue.length===0){ container.innerHTML='No more cards!'; return; }
    let card = swipeQueue.shift();
    card.views++;
    saveUser();
    let div = document.createElement('div');
    div.className='swipeCard';
    div.innerHTML = `<p>${card.text}</p><div class="stats">Likes: ${card.likes} | Views: ${card.views}</div>`;
    if(card.media){
      if(card.media.type.startsWith('image')) div.innerHTML+=`<img src="${card.media.src}">`;
      else if(card.media.type.startsWith('video')) div.innerHTML+=`<video controls src="${card.media.src}"></video>`;
      else if(card.media.type.startsWith('audio')) div.innerHTML+=`<audio controls src="${card.media.src}"></audio>`;
    }
    container.appendChild(div);

    // Swipe detection
    let startX=0;
    div.addEventListener('mousedown',e=>{ startX=e.clientX; });
    div.addEventListener('mouseup',e=>{
      let diff=e.clientX-startX;
      if(diff>50){ card.likes++; coins++; alert('Liked! +1 coin'); }
      else if(diff<-50){ card.skipped++; }
      showNextCard();
    });
  }

  /* ---------- QUESTS ---------- */
  const questPaths=[
    {name:'Card Collector', goals:[10,25,50,100,250], reward:[1,2,3,5,10]},
    {name:'Popular Creator', goals:[5,10,30,50,100,500], reward:[1,2,5,10,20,50]},
    {name:'View Master', goals:[100,200,500,1000,5000], reward:[1,2,5,10,20]}
  ];

  function showQuests(){
    document.getElementById('mainMenu').classList.add('hidden');
    document.getElementById('questsScreen').classList.remove('hidden');
    updateQuests();
  }

  function updateQuests(){
    let container = document.getElementById('questsContainer');
    container.innerHTML='';
    questPaths.forEach(p=>{
      let div = document.createElement('div'); div.className='questPath';
      div.innerHTML=`<strong>${p.name}</strong>`;
      p.goals.forEach((g,i)=>{
        let done=false;
        if(p.name==='Card Collector') done = currentCards.length>=g;
        if(p.name==='Popular Creator') done = currentCards.reduce((a,c)=>a+c.likes,0)>=g;
        if(p.name==='View Master') done = currentCards.reduce((a,c)=>a+c.views,0)>=g;
        div.innerHTML+=`<div class="quest">${g} - ${done?'✅':'❌'} (+${p.reward[i]} coin)</div>`;
        if(done && !p.claimed) { coins+=p.reward[i]; p.claimed=true; saveUser(); }
      });
      container.appendChild(div);
    });
    document.getElementById('coinsDisplay').innerText = 'Coins: '+coins;
  }
</script>
</body>
</html>
